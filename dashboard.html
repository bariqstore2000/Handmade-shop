<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة التحكم | Bariq Store</title>
  <style>
    body { font-family: 'Cairo', sans-serif; background: #fce4ec; padding: 2rem; }
    .product { background: #fff; padding: 1rem; border-radius: 12px; margin-bottom: 1rem; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    input { width: 100%; margin: 0.3rem 0; padding: 0.5rem; border-radius: 6px; border: 1px solid #ccc; }
    button { padding: 0.5rem 1rem; border: none; background: #e91e63; color: white; border-radius: 8px; margin-top: 0.5rem; cursor: pointer; }
    h2 { text-align: center; color: #c2185b; }
  </style>
</head>
<body>
  <h2>لوحة تحكم المنتجات</h2>
  <div id="productList"></div>

  <h3>إضافة منتج جديد</h3>
  <input type="text" id="newName" placeholder="اسم المنتج">
  <input type="number" id="newPrice" placeholder="السعر">
  <input type="text" id="newImage" placeholder="رابط الصورة">
  <button onclick="addProduct()">إضافة</button>

  <script>
    const binId = "6859dc408a456b7966b45e97";
    const apiKey = "$2a$10$5mDPhbojylWVObRzAhkf9OHB8AuuykL/cvlGx4rC3V1IRjwvTzA6a";
    let products = [];

    function loadProducts() {
      fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
        headers: { "X-Master-Key": apiKey }
      })
      .then(res => res.json())
      .then(data => {
        products = data.record.products || [];
        renderProducts();
      });
    }

    function renderProducts() {
      const list = document.getElementById("productList");
      list.innerHTML = "";
      products.forEach((p, i) => {
        list.innerHTML += `
          <div class="product">
            <input value="${p.name}" onchange="editProduct(${i}, 'name', this.value)">
            <input value="${p.price}" onchange="editProduct(${i}, 'price', this.value)">
            <input value="${p.image}" onchange="editProduct(${i}, 'image', this.value)">
            <button onclick="deleteProduct(${i})">حذف</button>
          </div>
        `;
      });
    }

    function updateBin() {
      fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": apiKey
        },
        body: JSON.stringify({ products })
      })
      .then(() => loadProducts());
    }

    function editProduct(index, field, value) {
      products[index][field] = field === "price" ? Number(value) : value;
      updateBin();
    }

    function deleteProduct(index) {
      if (confirm("هل أنت متأكد من الحذف؟")) {
        products.splice(index, 1);
        updateBin();
      }
    }

    function addProduct() {
      const name = document.getElementById("newName").value;
      const price = parseFloat(document.getElementById("newPrice").value);
      const image = document.getElementById("newImage").value;

      if (!name || !price || !image) {
        alert("يرجى ملء كل الحقول");
        return;
      }

      products.push({ name, price, image });
      updateBin();

      document.getElementById("newName").value = "";
      document.getElementById("newPrice").value = "";
      document.getElementById("newImage").value = "";
    }

    loadProducts();
  </script>
</body>
</html>
